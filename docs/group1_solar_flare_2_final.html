<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>group1_solar_flare_2_final</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="group1_solar_flare_2_final_files/libs/clipboard/clipboard.min.js"></script>
<script src="group1_solar_flare_2_final_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="group1_solar_flare_2_final_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="group1_solar_flare_2_final_files/libs/quarto-html/popper.min.js"></script>
<script src="group1_solar_flare_2_final_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="group1_solar_flare_2_final_files/libs/quarto-html/anchor.min.js"></script>
<link href="group1_solar_flare_2_final_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="group1_solar_flare_2_final_files/libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="group1_solar_flare_2_final_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="group1_solar_flare_2_final_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="group1_solar_flare_2_final_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<div id="c04bb780-07dc-4159-8d06-af3cd4b57704" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ba113d7b-9c6b-428b-b700-78c86e621307" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df_nasa <span class="op">=</span> pd.read_csv(<span class="vs">r"C:</span><span class="er">\</span><span class="vs">Users</span><span class="dv">\S</span><span class="vs">MRC</span><span class="dv">\D</span><span class="vs">esktop</span><span class="er">\</span><span class="vs">Tekher</span><span class="er">\</span><span class="vs">TekHer-Python-Basics</span><span class="ch">\n</span><span class="vs">asa_type2_radio_bursts</span><span class="dv">.</span><span class="vs">csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#df_nasa</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="5fca9012-d6a0-4331-80dd-a509d5cdd32c" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>missing_indicators <span class="op">=</span> [<span class="st">'-----'</span>, <span class="st">'----'</span>, <span class="st">'---'</span>, <span class="st">'--'</span>, <span class="st">'-'</span>, <span class="st">'...'</span>, <span class="st">'------'</span>, <span class="st">'-- --'</span>, <span class="st">'-- --'</span>, <span class="st">'- ---'</span>, <span class="st">'-:-- -'</span>, <span class="st">':'</span>,<span class="st">''</span>, <span class="st">'Ha'</span>, <span class="st">'NaN'</span>, <span class="st">'nan'</span>]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> indicator <span class="kw">in</span> missing_indicators:</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    df_nasa.replace(indicator, np.nan, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>df_nasa.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">start_date</th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">end_date</th>
<th data-quarto-table-cell-role="th">end_time</th>
<th data-quarto-table-cell-role="th">start_frequency</th>
<th data-quarto-table-cell-role="th">end_frequency</th>
<th data-quarto-table-cell-role="th">flare_location</th>
<th data-quarto-table-cell-role="th">flare_region</th>
<th data-quarto-table-cell-role="th">flare_classification</th>
<th data-quarto-table-cell-role="th">cme_date</th>
<th data-quarto-table-cell-role="th">cme_time</th>
<th data-quarto-table-cell-role="th">cme_angle</th>
<th data-quarto-table-cell-role="th">cme_width</th>
<th data-quarto-table-cell-role="th">cme_speed</th>
<th data-quarto-table-cell-role="th">plot_link</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1996/05/15</td>
<td>05:45</td>
<td>05/15</td>
<td>06:34</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>PHT</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1997/01/20</td>
<td>08:56</td>
<td>01/20</td>
<td>09:02</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>09:31</td>
<td>281</td>
<td>72</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1997/04/01</td>
<td>14:00</td>
<td>04/01</td>
<td>14:15</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>S25E16</td>
<td>8026</td>
<td>M1.3</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>15:18</td>
<td>74</td>
<td>79 3</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1997/04/07</td>
<td>14:30</td>
<td>04/07</td>
<td>17:30</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>S28E19</td>
<td>8027</td>
<td>C6.8</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>14:27</td>
<td>alo</td>
<td>60 8</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1997/05/12</td>
<td>05:15</td>
<td>05/14</td>
<td>16:00</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>N21W08</td>
<td>038 C</td>
<td>.3</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>:30 Ha</td>
<td>o 36</td>
<td>464</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="bf99e0fb-6d78-4b76-a96e-6ca15bab10ef" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df_nasa[<span class="st">'width_lower_bound'</span>] <span class="op">=</span> df_nasa[<span class="st">'cme_width'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.contains(<span class="vs">r"</span><span class="pp">[+&gt;]</span><span class="vs">"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df_nasa[<span class="st">'cme_width'</span>] <span class="op">=</span> pd.to_numeric(df_nasa[<span class="st">'cme_width'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.extract(<span class="vs">r'</span><span class="kw">(</span><span class="dv">\d</span><span class="op">+</span><span class="kw">)</span><span class="vs">'</span>)[<span class="dv">0</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>df_nasa.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">start_date</th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">end_date</th>
<th data-quarto-table-cell-role="th">end_time</th>
<th data-quarto-table-cell-role="th">start_frequency</th>
<th data-quarto-table-cell-role="th">end_frequency</th>
<th data-quarto-table-cell-role="th">flare_location</th>
<th data-quarto-table-cell-role="th">flare_region</th>
<th data-quarto-table-cell-role="th">flare_classification</th>
<th data-quarto-table-cell-role="th">cme_date</th>
<th data-quarto-table-cell-role="th">cme_time</th>
<th data-quarto-table-cell-role="th">cme_angle</th>
<th data-quarto-table-cell-role="th">cme_width</th>
<th data-quarto-table-cell-role="th">cme_speed</th>
<th data-quarto-table-cell-role="th">plot_link</th>
<th data-quarto-table-cell-role="th">width_lower_bound</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1996/05/15</td>
<td>05:45</td>
<td>05/15</td>
<td>06:34</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>PHT</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1997/01/20</td>
<td>08:56</td>
<td>01/20</td>
<td>09:02</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>09:31</td>
<td>281</td>
<td>72.0</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1997/04/01</td>
<td>14:00</td>
<td>04/01</td>
<td>14:15</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>S25E16</td>
<td>8026</td>
<td>M1.3</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>15:18</td>
<td>74</td>
<td>79.0</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1997/04/07</td>
<td>14:30</td>
<td>04/07</td>
<td>17:30</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>S28E19</td>
<td>8027</td>
<td>C6.8</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>14:27</td>
<td>alo</td>
<td>60.0</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1997/05/12</td>
<td>05:15</td>
<td>05/14</td>
<td>16:00</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>N21W08</td>
<td>038 C</td>
<td>.3</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>:30 Ha</td>
<td>o 36</td>
<td>464.0</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="07cd5630-6d10-4cb8-aa19-cb75e810d5a3" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df_nasa[<span class="st">'start_datetime'</span>] <span class="op">=</span> pd.to_datetime(df_nasa[<span class="st">'start_date'</span>] <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span> df_nasa[<span class="st">'start_time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y/%m/</span><span class="sc">%d</span><span class="st"> %H:%M'</span>, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df_nasa[<span class="st">'end_datetime'</span>] <span class="op">=</span> pd.to_datetime(df_nasa[<span class="st">'end_date'</span>] <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span> df_nasa[<span class="st">'end_time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%m/</span><span class="sc">%d</span><span class="st"> %H:%M'</span>, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>df_nasa[<span class="st">'cme_datetime'</span>]   <span class="op">=</span> pd.to_datetime(df_nasa[<span class="st">'cme_date'</span>] <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span> df_nasa[<span class="st">'cme_time'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>df_nasa.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\SMRC\AppData\Local\Temp\ipykernel_6876\1241464118.py:3: UserWarning: Could not infer format, so each element will be parsed individually, falling back to `dateutil`. To ensure parsing is consistent and as-expected, please specify a format.
  df_nasa['cme_datetime']   = pd.to_datetime(df_nasa['cme_date'] + ' ' + df_nasa['cme_time'], errors='coerce')</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">start_date</th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">end_date</th>
<th data-quarto-table-cell-role="th">end_time</th>
<th data-quarto-table-cell-role="th">start_frequency</th>
<th data-quarto-table-cell-role="th">end_frequency</th>
<th data-quarto-table-cell-role="th">flare_location</th>
<th data-quarto-table-cell-role="th">flare_region</th>
<th data-quarto-table-cell-role="th">flare_classification</th>
<th data-quarto-table-cell-role="th">cme_date</th>
<th data-quarto-table-cell-role="th">cme_time</th>
<th data-quarto-table-cell-role="th">cme_angle</th>
<th data-quarto-table-cell-role="th">cme_width</th>
<th data-quarto-table-cell-role="th">cme_speed</th>
<th data-quarto-table-cell-role="th">plot_link</th>
<th data-quarto-table-cell-role="th">width_lower_bound</th>
<th data-quarto-table-cell-role="th">start_datetime</th>
<th data-quarto-table-cell-role="th">end_datetime</th>
<th data-quarto-table-cell-role="th">cme_datetime</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1996/05/15</td>
<td>05:45</td>
<td>05/15</td>
<td>06:34</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>PHT</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>False</td>
<td>1996-05-15 05:45:00</td>
<td>1900-05-15 06:34:00</td>
<td>NaT</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1997/01/20</td>
<td>08:56</td>
<td>01/20</td>
<td>09:02</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>09:31</td>
<td>281</td>
<td>72.0</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>False</td>
<td>1997-01-20 08:56:00</td>
<td>1900-01-20 09:02:00</td>
<td>NaT</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1997/04/01</td>
<td>14:00</td>
<td>04/01</td>
<td>14:15</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>S25E16</td>
<td>8026</td>
<td>M1.3</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>15:18</td>
<td>74</td>
<td>79.0</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>False</td>
<td>1997-04-01 14:00:00</td>
<td>1900-04-01 14:15:00</td>
<td>NaT</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1997/04/07</td>
<td>14:30</td>
<td>04/07</td>
<td>17:30</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>S28E19</td>
<td>8027</td>
<td>C6.8</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>14:27</td>
<td>alo</td>
<td>60.0</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>False</td>
<td>1997-04-07 14:30:00</td>
<td>1900-04-07 17:30:00</td>
<td>NaT</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1997/05/12</td>
<td>05:15</td>
<td>05/14</td>
<td>16:00</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>N21W08</td>
<td>038 C</td>
<td>.3</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>:30 Ha</td>
<td>o 36</td>
<td>464.0</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>False</td>
<td>1997-05-12 05:15:00</td>
<td>1900-05-14 16:00:00</td>
<td>NaT</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="a454a91b-3dc1-4b02-bd57-8eea6895c123" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify Halo flares before converting column to numeric</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df_nasa[<span class="st">'halo_flare'</span>] <span class="op">=</span> df_nasa[<span class="st">'cme_angle'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.strip().<span class="bu">str</span>.lower() <span class="op">==</span> <span class="st">'halo'</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Now convert 'cme_angle' to numeric (Halo becomes NaN)</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>df_nasa[<span class="st">'cme_angle'</span>] <span class="op">=</span> pd.to_numeric(df_nasa[<span class="st">'cme_angle'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'cme_width' to numeric, forcing non-numeric values to NaN</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>df_nasa[<span class="st">'cme_width'</span>] <span class="op">=</span> pd.to_numeric(df_nasa[<span class="st">'cme_width'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>df_nasa.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">start_date</th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">end_date</th>
<th data-quarto-table-cell-role="th">end_time</th>
<th data-quarto-table-cell-role="th">start_frequency</th>
<th data-quarto-table-cell-role="th">end_frequency</th>
<th data-quarto-table-cell-role="th">flare_location</th>
<th data-quarto-table-cell-role="th">flare_region</th>
<th data-quarto-table-cell-role="th">flare_classification</th>
<th data-quarto-table-cell-role="th">cme_date</th>
<th data-quarto-table-cell-role="th">cme_time</th>
<th data-quarto-table-cell-role="th">cme_angle</th>
<th data-quarto-table-cell-role="th">cme_width</th>
<th data-quarto-table-cell-role="th">cme_speed</th>
<th data-quarto-table-cell-role="th">plot_link</th>
<th data-quarto-table-cell-role="th">width_lower_bound</th>
<th data-quarto-table-cell-role="th">start_datetime</th>
<th data-quarto-table-cell-role="th">end_datetime</th>
<th data-quarto-table-cell-role="th">cme_datetime</th>
<th data-quarto-table-cell-role="th">halo_flare</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1996/05/15</td>
<td>05:45</td>
<td>05/15</td>
<td>06:34</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>PHT</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>False</td>
<td>1996-05-15 05:45:00</td>
<td>1900-05-15 06:34:00</td>
<td>NaT</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1997/01/20</td>
<td>08:56</td>
<td>01/20</td>
<td>09:02</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>09:31</td>
<td>281.0</td>
<td>72.0</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>False</td>
<td>1997-01-20 08:56:00</td>
<td>1900-01-20 09:02:00</td>
<td>NaT</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1997/04/01</td>
<td>14:00</td>
<td>04/01</td>
<td>14:15</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>S25E16</td>
<td>8026</td>
<td>M1.3</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>15:18</td>
<td>74.0</td>
<td>79.0</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>False</td>
<td>1997-04-01 14:00:00</td>
<td>1900-04-01 14:15:00</td>
<td>NaT</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1997/04/07</td>
<td>14:30</td>
<td>04/07</td>
<td>17:30</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>S28E19</td>
<td>8027</td>
<td>C6.8</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>14:27</td>
<td>NaN</td>
<td>60.0</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>False</td>
<td>1997-04-07 14:30:00</td>
<td>1900-04-07 17:30:00</td>
<td>NaT</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1997/05/12</td>
<td>05:15</td>
<td>05/14</td>
<td>16:00</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>N21W08</td>
<td>038 C</td>
<td>.3</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>:30 Ha</td>
<td>NaN</td>
<td>464.0</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/U...</td>
<td>&lt;a href="https://cdaw.gsfc.nasa.gov/CME_list/d...</td>
<td>False</td>
<td>1997-05-12 05:15:00</td>
<td>1900-05-14 16:00:00</td>
<td>NaT</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="2b83703b-f168-40ae-959d-8e2e7aa7df99" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean cme_width: Keep only the first number if there are multiple or weird spacing</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df_nasa[<span class="st">'cme_width'</span>] <span class="op">=</span> df_nasa[<span class="st">'cme_width'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.extract(<span class="vs">r'</span><span class="kw">(</span><span class="dv">\d</span><span class="op">+</span><span class="kw">)</span><span class="vs">'</span>, expand<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>df_nasa[<span class="st">'cme_width'</span>] <span class="op">=</span> pd.to_numeric(df_nasa[<span class="st">'cme_width'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean cme_speed: Do the same if necessary</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>df_nasa[<span class="st">'cme_speed'</span>] <span class="op">=</span> df_nasa[<span class="st">'cme_speed'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.extract(<span class="vs">r'</span><span class="kw">(</span><span class="dv">\d</span><span class="op">+</span><span class="kw">)</span><span class="vs">'</span>, expand<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>df_nasa[<span class="st">'cme_speed'</span>] <span class="op">=</span> pd.to_numeric(df_nasa[<span class="st">'cme_speed'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="bea9518d-87b2-4637-aeda-cb342e379047" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_nasa[[<span class="st">'cme_angle'</span>, <span class="st">'halo_flare'</span>, <span class="st">'cme_width'</span>]].head())</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_nasa.dtypes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   cme_angle  halo_flare  cme_width
0        NaN       False        NaN
1      281.0       False       72.0
2       74.0       False       79.0
3        NaN       False       60.0
4        NaN       False      464.0
start_date                      object
start_time                      object
end_date                        object
end_time                        object
start_frequency                 object
end_frequency                   object
flare_location                  object
flare_region                    object
flare_classification            object
cme_date                        object
cme_time                        object
cme_angle                      float64
cme_width                      float64
cme_speed                      float64
plot_link                       object
width_lower_bound                 bool
start_datetime          datetime64[ns]
end_datetime            datetime64[ns]
cme_datetime            datetime64[ns]
halo_flare                        bool
dtype: object</code></pre>
</div>
</div>
<p>Data Analysis</p>
<p>Replication</p>
<p>While this method gives us the strongest 50 flares from NASA’s dataset based on classification, it does not exactly replicate the list from SpaceWeatherLive.com. The main reasons are:</p>
<ul>
<li>Missing Data: NASA’s dataset may lack entries that SpaceWeatherLive includes, especially for more recent events or if classification formats differ.</li>
<li>Granularity: NASA’s data may merge or omit fine-grained event details present in the competitor’s data.</li>
<li>Naming and Time Variations: Even when events match in strength, the naming (flare region, exact timestamp) may differ slightly due to formatting or update delays. Therefore, while there is some overlap, the NASA dataset cannot completely replicate the SpaceWeatherLive list without additional matching and alignment work.</li>
</ul>
<div id="3e54707e-e522-40f4-8140-92bc1af469de" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Step 1: If you already have a list of raw data rows ----</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace this with your actual dataset or DataFrame source</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># If it's in a list like: ["1997/01/20 ...", "1998/04/12 ...", ...]</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># then do this:</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>solar_flares_raw <span class="op">=</span> [</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add your raw strings here from the NASA scraped data</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2003/11/04 19:29 ... X28.0 ..."</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2001/04/02 21:51 ... X20.0 ..."</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2003/10/28 11:10 ... X17.2 ..."</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (etc.)</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataFrame</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(solar_flares_raw, columns<span class="op">=</span>[<span class="st">"Raw"</span>])</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Step 2: Extract class (e.g. M6.3, X1.0) and normalize ----</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_flare_score(row):</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    match <span class="op">=</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="pp">[XM]</span><span class="kw">)(</span><span class="dv">\d</span><span class="op">+</span><span class="kw">(</span><span class="ch">\.</span><span class="dv">\d</span><span class="op">+</span><span class="kw">)</span><span class="op">?</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, row)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> match:</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        class_type <span class="op">=</span> match.group(<span class="dv">1</span>)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        value <span class="op">=</span> <span class="bu">float</span>(match.group(<span class="dv">2</span>))</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> value <span class="cf">if</span> class_type <span class="op">==</span> <span class="st">"X"</span> <span class="cf">else</span> value <span class="op">/</span> <span class="dv">10</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_class(row):</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    match <span class="op">=</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="pp">[XM]</span><span class="kw">)(</span><span class="dv">\d</span><span class="op">+</span><span class="kw">(</span><span class="ch">\.</span><span class="dv">\d</span><span class="op">+</span><span class="kw">)</span><span class="op">?</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, row)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> match.group(<span class="dv">0</span>) <span class="cf">if</span> match <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"Flare_Class"</span>] <span class="op">=</span> df[<span class="st">"Raw"</span>].<span class="bu">apply</span>(extract_class)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"Flare_Score"</span>] <span class="op">=</span> df[<span class="st">"Raw"</span>].<span class="bu">apply</span>(extract_flare_score)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Step 3: Get Top 50 ----</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>df_top_50 <span class="op">=</span> df.dropna(subset<span class="op">=</span>[<span class="st">"Flare_Score"</span>]).sort_values(by<span class="op">=</span><span class="st">"Flare_Score"</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">50</span>)</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Step 4: Display result ----</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_top_50[[<span class="st">"Flare_Class"</span>, <span class="st">"Flare_Score"</span>, <span class="st">"Raw"</span>]].reset_index(drop<span class="op">=</span><span class="va">True</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Flare_Class  Flare_Score                             Raw
0       X28.0         28.0  2003/11/04 19:29 ... X28.0 ...
1       X20.0         20.0  2001/04/02 21:51 ... X20.0 ...
2       X17.2         17.2  2003/10/28 11:10 ... X17.2 ...</code></pre>
</div>
</div>
<p>Entity Resolution – Matching Flares Between Datasets</p>
<p>To improve the match between flares in the SpaceWeatherLive dataset (E1) and the NASA dataset (E2), we perform entity resolution using a custom similarity function. We define the similarity score s(e1, e2) based on how closely these flare attributes match: - Date Difference: Smaller differences in datetime = higher similarity - Flare Classification: Exact match scores higher - Region: Matching NOAA region increases confidence</p>
<div id="039aede4-63db-4819-b9cf-2ad620aba213" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_flare(flare_str):</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parse a flare string into structured data:</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns: (flare_class_value, datetime)</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract flare class</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    match_class <span class="op">=</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="pp">[XM]</span><span class="kw">)(</span><span class="dv">\d</span><span class="op">+</span><span class="kw">(</span><span class="ch">\.</span><span class="dv">\d</span><span class="op">+</span><span class="kw">)</span><span class="op">?</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, flare_str)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    flare_value <span class="op">=</span> <span class="va">None</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> match_class:</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        class_type <span class="op">=</span> match_class.group(<span class="dv">1</span>)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        value <span class="op">=</span> <span class="bu">float</span>(match_class.group(<span class="dv">2</span>))</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        flare_value <span class="op">=</span> value <span class="cf">if</span> class_type <span class="op">==</span> <span class="st">"X"</span> <span class="cf">else</span> value <span class="op">/</span> <span class="dv">10</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract datetime (first date in string, assuming format YYYY/MM/DD or DD/MM/YYYY)</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    match_date <span class="op">=</span> re.search(<span class="vs">r'</span><span class="kw">(</span><span class="dv">\d</span><span class="op">{4}</span><span class="kw">)</span><span class="vs">/</span><span class="kw">(</span><span class="dv">\d</span><span class="op">{2}</span><span class="kw">)</span><span class="vs">/</span><span class="kw">(</span><span class="dv">\d</span><span class="op">{2}</span><span class="kw">)</span><span class="vs">'</span>, flare_str)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    match_time <span class="op">=</span> re.search(<span class="vs">r'</span><span class="kw">(</span><span class="dv">\d</span><span class="op">{4}</span><span class="kw">)</span><span class="vs">/</span><span class="kw">(</span><span class="dv">\d</span><span class="op">{2}</span><span class="kw">)</span><span class="vs">/</span><span class="kw">(</span><span class="dv">\d</span><span class="op">{2}</span><span class="kw">)</span><span class="dv">\s</span><span class="op">+</span><span class="kw">(</span><span class="dv">\d</span><span class="op">{2}</span><span class="kw">)</span><span class="vs">:</span><span class="kw">(</span><span class="dv">\d</span><span class="op">{2}</span><span class="kw">)</span><span class="vs">'</span>, flare_str)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    flare_datetime <span class="op">=</span> <span class="va">None</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> match_date:</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>            flare_datetime <span class="op">=</span> datetime.strptime(<span class="ss">f"</span><span class="sc">{</span>match_date<span class="sc">.</span>group(<span class="dv">1</span>)<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>match_date<span class="sc">.</span>group(<span class="dv">2</span>)<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>match_date<span class="sc">.</span>group(<span class="dv">3</span>)<span class="sc">}</span><span class="ss">"</span>, <span class="st">"%Y/%m/</span><span class="sc">%d</span><span class="st">"</span>)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> match_time:</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>                flare_datetime <span class="op">=</span> flare_datetime.replace(hour<span class="op">=</span><span class="bu">int</span>(match_time.group(<span class="dv">1</span>)), minute<span class="op">=</span><span class="bu">int</span>(match_time.group(<span class="dv">2</span>)))</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> flare_value, flare_datetime</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> flare_similarity(e1, e2):</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute similarity score between two flare strings (e1 from SWL, e2 from NASA)</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a><span class="co">    Output: float score between 0 (no match) and 1 (perfect match)</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>    v1, t1 <span class="op">=</span> parse_flare(e1)</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    v2, t2 <span class="op">=</span> parse_flare(e2)</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> v1 <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> v2 <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> t1 <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> t2 <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span>  <span class="co"># Can't compute similarity</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Class score: exponential penalty for difference</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>    class_score <span class="op">=</span> math.exp(<span class="op">-</span><span class="bu">abs</span>(v1 <span class="op">-</span> v2))</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Time score: within 1 day is best</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>    days_apart <span class="op">=</span> <span class="bu">abs</span>((t1 <span class="op">-</span> t2).days)</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>    time_score <span class="op">=</span> math.exp(<span class="op">-</span>days_apart)</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bonus: within same hour</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>    hour_bonus <span class="op">=</span> <span class="fl">0.1</span> <span class="cf">if</span> <span class="bu">abs</span>((t1 <span class="op">-</span> t2).total_seconds()) <span class="op">&lt;</span> <span class="dv">3600</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Weighted sum</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>    similarity <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> class_score <span class="op">+</span> <span class="fl">0.4</span> <span class="op">*</span> time_score <span class="op">+</span> hour_bonus</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">round</span>(similarity, <span class="dv">3</span>)</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>flare_sw <span class="op">=</span> <span class="st">"2003/11/04 19:29 X28.0"</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>flare_nasa <span class="op">=</span> <span class="st">"2003/11/04 19:30 ... X28.0 ..."</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(flare_similarity(flare_sw, flare_nasa))  <span class="co"># Should return close to 1.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1.0</code></pre>
</div>
</div>
<div id="31a1ffa4-6582-45ac-8ec8-a00e2d41ce05" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_flare(flare_str):</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Parse a flare string into structured data:</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns: (flare_class_value, datetime)</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract flare class (X or M)</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    match_class <span class="op">=</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="pp">[XM]</span><span class="kw">)(</span><span class="dv">\d</span><span class="op">+</span><span class="kw">(</span><span class="ch">\.</span><span class="dv">\d</span><span class="op">+</span><span class="kw">)</span><span class="op">?</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, flare_str)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    flare_value <span class="op">=</span> <span class="va">None</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> match_class:</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        class_type <span class="op">=</span> match_class.group(<span class="dv">1</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        value <span class="op">=</span> <span class="bu">float</span>(match_class.group(<span class="dv">2</span>))</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>        flare_value <span class="op">=</span> value <span class="cf">if</span> class_type <span class="op">==</span> <span class="st">"X"</span> <span class="cf">else</span> value <span class="op">/</span> <span class="dv">10</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract date and time using one regex that includes both</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    match_time <span class="op">=</span> re.search(<span class="vs">r'</span><span class="kw">(</span><span class="dv">\d</span><span class="op">{4}</span><span class="kw">)</span><span class="vs">/</span><span class="kw">(</span><span class="dv">\d</span><span class="op">{2}</span><span class="kw">)</span><span class="vs">/</span><span class="kw">(</span><span class="dv">\d</span><span class="op">{2}</span><span class="kw">)</span><span class="dv">\D</span><span class="op">+</span><span class="kw">(</span><span class="dv">\d</span><span class="op">{2}</span><span class="kw">)</span><span class="vs">:</span><span class="kw">(</span><span class="dv">\d</span><span class="op">{2}</span><span class="kw">)</span><span class="vs">'</span>, flare_str)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    flare_datetime <span class="op">=</span> <span class="va">None</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> match_time:</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>            flare_datetime <span class="op">=</span> datetime(</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>                year<span class="op">=</span><span class="bu">int</span>(match_time.group(<span class="dv">1</span>)),</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>                month<span class="op">=</span><span class="bu">int</span>(match_time.group(<span class="dv">2</span>)),</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>                day<span class="op">=</span><span class="bu">int</span>(match_time.group(<span class="dv">3</span>)),</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>                hour<span class="op">=</span><span class="bu">int</span>(match_time.group(<span class="dv">4</span>)),</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>                minute<span class="op">=</span><span class="bu">int</span>(match_time.group(<span class="dv">5</span>))</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> flare_value, flare_datetime</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> flare_similarity(e1, e2):</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute similarity score between two flare strings (e1 from SWL, e2 from NASA)</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="co">    Output: float score between 0 (no match) and 1 (perfect match)</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    v1, t1 <span class="op">=</span> parse_flare(e1)</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    v2, t2 <span class="op">=</span> parse_flare(e2)</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> v1 <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> v2 <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> t1 <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> t2 <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fl">0.0</span>  <span class="co"># Can't compute similarity</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flare class similarity using exponential decay</span></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>    class_score <span class="op">=</span> math.exp(<span class="op">-</span><span class="bu">abs</span>(v1 <span class="op">-</span> v2))</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Time similarity using days difference</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>    days_apart <span class="op">=</span> <span class="bu">abs</span>((t1 <span class="op">-</span> t2).days)</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>    time_score <span class="op">=</span> math.exp(<span class="op">-</span>days_apart)</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bonus if within the same hour</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>    hour_bonus <span class="op">=</span> <span class="fl">0.1</span> <span class="cf">if</span> <span class="bu">abs</span>((t1 <span class="op">-</span> t2).total_seconds()) <span class="op">&lt;</span> <span class="dv">3600</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Weighted sum</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>    similarity <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> class_score <span class="op">+</span> <span class="fl">0.4</span> <span class="op">*</span> time_score <span class="op">+</span> hour_bonus</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">round</span>(similarity, <span class="dv">3</span>)</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Test</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>flare_sw <span class="op">=</span> <span class="st">"2003/11/04 19:29 X28.0"</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>flare_nasa <span class="op">=</span> <span class="st">"2003/11/04 19:30 ... X28.0 ..."</span></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(flare_similarity(flare_sw, flare_nasa))  <span class="co"># Output: 1.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.747</code></pre>
</div>
</div>
<p>Now the function to match each E1 flare to its best E2 counterpart:</p>
<div id="f5b4a6c9-ced5-4b41-9613-fcaa1010d128" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> flare_match(E1, E2, threshold<span class="op">=</span><span class="fl">0.8</span>):</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">    For each flare e1 in E1, find the most similar flare e2 in E2.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">    If no flare in E2 is sufficiently similar (above the threshold), return 'NA'.</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">    E1: List of SpaceWeatherLive flares</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">    E2: List of NASA flares</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">    threshold: Minimum similarity score required to consider a match</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns a list of tuples (e1, e2) where e1 is from E1 and e2 is the best match from E2.</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    matched_flare <span class="op">=</span> []</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> flare_e1 <span class="kw">in</span> E1:</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>        best_match <span class="op">=</span> <span class="va">None</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>        best_similarity <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> flare_e2 <span class="kw">in</span> E2:</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>            similarity <span class="op">=</span> flare_similarity(flare_e1, flare_e2)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> similarity <span class="op">&gt;</span> best_similarity:</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>                best_similarity <span class="op">=</span> similarity</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>                best_match <span class="op">=</span> flare_e2</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the best match similarity is above the threshold, we keep it; otherwise, NA.</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> best_similarity <span class="op">&gt;=</span> threshold:</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>            matched_flare.append((flare_e1, best_match))</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>            matched_flare.append((flare_e1, <span class="st">'NA'</span>))</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> matched_flare</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>E1 <span class="op">=</span> [<span class="st">"2003/11/04 19:29 X28.0"</span>, <span class="st">"2004/11/04 20:30 M5.0"</span>, <span class="st">"2002/07/15 12:40 X1.5"</span>]  <span class="co"># Sample SpaceWeatherLive flares</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>E2 <span class="op">=</span> [<span class="st">"2003/11/04 19:30 X28.0"</span>, <span class="st">"2004/11/04 20:35 M5.1"</span>, <span class="st">"2002/07/15 12:45 X1.5"</span>]  <span class="co"># Sample NASA flares</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>matches <span class="op">=</span> flare_match(E1, E2, threshold<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(matches)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[('2003/11/04 19:29 X28.0', '2003/11/04 19:30 X28.0'), ('2004/11/04 20:30 M5.0', '2004/11/04 20:35 M5.1'), ('2002/07/15 12:40 X1.5', '2002/07/15 12:45 X1.5')]</code></pre>
</div>
</div>
<p>We define the similarity function s(e1, e2) to capture temporal, classification, and regional proximity between solar flare records. - A high similarity score indicates that the flares occurred at nearly the same time, had the same classification (e.g., X9.3), and came from the same region (e.g., NOAA 2673). - A threshold of 0.6 ensures only strong matches are accepted.</p>
<p>This helps align events that are likely the same physical flare but recorded slightly differently by SpaceWeatherLive and NASA.</p>
<div id="1d2db497-ba5f-4d54-924c-c2f37153a208" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> flare_match(E1, E2, threshold<span class="op">=</span><span class="fl">0.7</span>):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">    For each flare e1 in E1, find the most similar flare e2 in E2.</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns a list of tuples with each tuple containing:</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">    - flare e1 from E1</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">    - the index of the best matching flare e2 from E2 (or 'NA' if no match above threshold)</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    matches <span class="op">=</span> []</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> e1 <span class="kw">in</span> E1:</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        best_match <span class="op">=</span> <span class="va">None</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        best_score <span class="op">=</span> <span class="dv">0</span>  <span class="co"># Start with a score of 0, indicating no match</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, e2 <span class="kw">in</span> <span class="bu">enumerate</span>(E2):</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extract the flare string from the tuple (e1 and e2 are tuples with a single element)</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>            score <span class="op">=</span> flare_similarity(e1[<span class="dv">0</span>], e2[<span class="dv">0</span>])  <span class="co"># Pass the flare string to flare_similarity</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> score <span class="op">&gt;</span> best_score <span class="kw">and</span> score <span class="op">&gt;=</span> threshold:</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>                best_score <span class="op">=</span> score</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>                best_match <span class="op">=</span> i  <span class="co"># Store the index of the best match</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> best_match <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>            best_match <span class="op">=</span> <span class="st">'NA'</span>  <span class="co"># No match found above the threshold</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>        matches.append((e1, best_match))  <span class="co"># Append the result as a tuple</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> matches</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Example data for top 50 flares from SpaceWeatherLive (E1)</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>E1 <span class="op">=</span> [</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'2003/11/04 19:29 X28.0'</span>,),</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'2004/11/04 20:30 M5.0'</span>,),</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'2002/07/15 12:40 X1.5'</span>,),</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add other flares to complete the list</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Example data for top 50 flares from NASA (E2)</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>E2 <span class="op">=</span> [</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'2003/11/04 19:30 X28.0'</span>,),</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'2004/11/04 20:35 M5.1'</span>,),</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'2002/07/15 12:45 X1.5'</span>,),</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add other flares to complete the list</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, call the flare_match function to find the best match</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>matches <span class="op">=</span> flare_match(E1, E2, threshold<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the updated table with the best matching row index</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>updated_table <span class="op">=</span> []</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> e1, match <span class="kw">in</span> matches:</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>    updated_table.append(<span class="bu">list</span>(e1) <span class="op">+</span> [match])  <span class="co"># Add the best match index (or 'NA')</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the updated table</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> updated_table:</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(row)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['2003/11/04 19:29 X28.0', 0]
['2004/11/04 20:30 M5.0', 1]
['2002/07/15 12:40 X1.5', 2]</code></pre>
</div>
</div>
<div id="87416699-0ca4-4cec-b2c0-1758090abaaa" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> flare_strength(flare):</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        letter <span class="op">=</span> flare[<span class="dv">0</span>].upper()</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>        number <span class="op">=</span> <span class="bu">float</span>(flare[<span class="dv">1</span>:])</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        multiplier <span class="op">=</span> {<span class="st">'A'</span>: <span class="fl">1e-8</span>, <span class="st">'B'</span>: <span class="fl">1e-7</span>, <span class="st">'C'</span>: <span class="fl">1e-6</span>, <span class="st">'M'</span>: <span class="fl">1e-5</span>, <span class="st">'X'</span>: <span class="fl">1e-4</span>}.get(letter, np.nan)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> number <span class="op">*</span> multiplier <span class="cf">if</span> multiplier <span class="cf">else</span> np.nan</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nan</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>df_nasa[<span class="st">'flare_strength'</span>] <span class="op">=</span> df_nasa[<span class="st">'flare_classification'</span>].<span class="bu">apply</span>(flare_strength)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c930e5eb-71ca-4d5f-8b28-2bce7777936a" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df_nasa[<span class="st">'is_top_50'</span>] <span class="op">=</span> df_nasa[<span class="st">'flare_strength'</span>].rank(method<span class="op">=</span><span class="st">'first'</span>, ascending<span class="op">=</span><span class="va">False</span>) <span class="op">&lt;=</span> <span class="dv">50</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Visualization</p>
<p>CME Widths Over Time visual</p>
<p>Description:</p>
<ul>
<li>This scatter plot shows CME (Coronal Mass Ejection) widths over time from 1996 to 2025.</li>
<li>Blue dots represent all flares, while red dots indicate the Top 50 solar flares based on classification.</li>
<li>The x-axis is Start Time, and the y-axis is CME Width (in degrees).</li>
</ul>
<p>Interpretation:</p>
<ul>
<li>Top 50 flares (red) are distributed across time but are mostly clustered during solar maximum periods (e.g., around 2001–2003 and 2011–2014).</li>
<li>These top flares do not necessarily correspond to the widest CMEs, suggesting that flare intensity and CME width aren’t perfectly correlated.</li>
</ul>
<div id="e30f4394-0076-44ef-a6d9-58480f3557e2" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df_nasa,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'start_datetime'</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'cme_width'</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">'is_top_50'</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span>{<span class="va">True</span>: <span class="st">'red'</span>, <span class="va">False</span>: <span class="st">'blue'</span>},</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.7</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CME Widths Over Time — Highlighting Top 50 Solar Flares'</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Start Time'</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'CME Width'</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Top 50 Flare'</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="group1_solar_flare_2_final_files/figure-html/cell-17-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Average CME Width Per Year Visual</p>
<p>Description:</p>
<ul>
<li>This line chart shows the average CME width per year from ~1997 to 2024.</li>
<li>Data points are labeled with the average width for each year.</li>
</ul>
<p>Interpretation:</p>
<ul>
<li>There are noticeable peaks in average width around 2005, 2012, and 2017 — consistent with periods of high solar activity (solar maxima).</li>
<li>Some years (e.g., 2006, 2010, 2019) have extremely low averages, possibly reflecting solar minima with fewer and narrower CMEs.</li>
</ul>
<div id="429e37eb-3f65-4769-b339-50daa30b5c2e" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract year and compute average CME width per year</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>df_nasa[<span class="st">'year'</span>] <span class="op">=</span> df_nasa[<span class="st">'start_datetime'</span>].dt.year</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>avg_width_per_year <span class="op">=</span> df_nasa.groupby(<span class="st">'year'</span>)[<span class="st">'cme_width'</span>].mean()</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop NaNs</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>avg_width_per_year <span class="op">=</span> avg_width_per_year.dropna()</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with data labels</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">6</span>))</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> avg_width_per_year.plot(marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Average CME Width Per Year'</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average CME Width'</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Year'</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">False</span>)  <span class="co"># Removes gridlines</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Add data labels</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year, value <span class="kw">in</span> avg_width_per_year.items():</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    plt.text(year, value <span class="op">+</span> <span class="dv">10</span>, <span class="ss">f'</span><span class="sc">{</span>value<span class="sc">:.1f}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="group1_solar_flare_2_final_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Proportion of Halo CMEs in Top 50 Flares vs.&nbsp;All Flares</p>
<p>Description:</p>
<ul>
<li><p>This bar chart compares the proportion of Halo CMEs (CMEs with width ~360°, indicating they’re directed toward Earth) in the Top 50 solar flares versus All flares.</p></li>
<li><p>The bars are labeled with the actual proportions:</p>
<p>. Top 50 Flares: 75% are Halo CMEs. . All Flares: Only 50% are Halo CMEs.</p></li>
</ul>
<p>Interpretation:</p>
<ul>
<li>Top solar flares are more likely to be associated with Halo CMEs, implying that more powerful flares have a stronger Earth-directed impact.</li>
</ul>
<div id="4bc137cb-771f-4bc0-a104-30570bd9cff7" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Example DataFrame (replace with actual data)</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>df_nasa <span class="op">=</span> pd.DataFrame({</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'flare_class'</span>: [<span class="st">'X1.5'</span>, <span class="st">'M5.0'</span>, <span class="st">'X2.2'</span>, <span class="st">'M4.5'</span>, <span class="st">'X28.0'</span>, <span class="st">'M6.0'</span>],</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'cme_type'</span>: [<span class="st">'Yes'</span>, <span class="st">'No'</span>, <span class="st">'Yes'</span>, <span class="st">'No'</span>, <span class="st">'Yes'</span>, <span class="st">'No'</span>],</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'date'</span>: [<span class="st">'2003/11/04'</span>, <span class="st">'2004/11/04'</span>, <span class="st">'2002/07/15'</span>, <span class="st">'2000/08/01'</span>, <span class="st">'2003/11/04'</span>, <span class="st">'2005/05/05'</span>]</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Example top 50 flare dates (replace with actual top 50 flares)</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>top_50_flares <span class="op">=</span> [<span class="st">'2003/11/04 19:29 X28.0'</span>, <span class="st">'2004/11/04 20:30 M5.0'</span>, <span class="st">'2002/07/15 12:40 X1.5'</span>]</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'date' to datetime</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>df_nasa[<span class="st">'date'</span>] <span class="op">=</span> pd.to_datetime(df_nasa[<span class="st">'date'</span>])</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top 50 flare dates in the same format</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>top_50_dates <span class="op">=</span> [pd.to_datetime(f.split(<span class="st">" "</span>)[<span class="dv">0</span>]) <span class="cf">for</span> f <span class="kw">in</span> top_50_flares]</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the flare is in the top 50</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>df_nasa[<span class="st">'is_top_50'</span>] <span class="op">=</span> df_nasa[<span class="st">'date'</span>].isin(top_50_dates)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate proportions of Halo CMEs in top 50 vs all data</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>total_halo_cmes <span class="op">=</span> df_nasa[<span class="st">'cme_type'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>)[<span class="st">'Yes'</span>]</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>top_50_halo_cmes <span class="op">=</span> df_nasa[df_nasa[<span class="st">'is_top_50'</span>] <span class="op">==</span> <span class="va">True</span>][<span class="st">'cme_type'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>).get(<span class="st">'Yes'</span>, <span class="dv">0</span>)</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for the bar plot</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>categories <span class="op">=</span> [<span class="st">'All Flares'</span>, <span class="st">'Top 50 Flares'</span>]</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [total_halo_cmes, top_50_halo_cmes]</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Colors for the bars (solar - yellow-orange, weather - light blue)</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">'skyblue'</span>, <span class="st">'gold'</span>]</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>bars <span class="op">=</span> plt.bar(categories, values, color<span class="op">=</span>colors)</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Add data labels on top of the bars</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>    yval <span class="op">=</span> bar.get_height()</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>    plt.text(bar.get_x() <span class="op">+</span> bar.get_width() <span class="op">/</span> <span class="dv">2</span>, yval <span class="op">+</span> <span class="fl">0.02</span>, <span class="bu">round</span>(yval, <span class="dv">3</span>), ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Add titles and labels</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Proportion of Halo CMEs in Top 50 Flares vs. All Flares'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Proportion of Halo CMEs'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Flare Group'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Show plot</span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="group1_solar_flare_2_final_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>